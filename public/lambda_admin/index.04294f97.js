import{H as L,T as P}from"./components.e94594b1.js";import{j as R,s as l,K as $,P as K,y as N,z,A as w,B as A,C as D,k as C,D as U,E as k,G as H,H as j,a as B,o as p,c as f,w as h,e as v,q,F as J,r as c,v as V,M as F,L as G,b as T,I as Q,f as b,p as M,h as I,m as W,i as X,t as Y}from"./entry.8ecb60d7.js";import{R as Z}from"./RenderSubMenu.943cf00b.js";import"./nuxt-link.80a1abf0.js";const x=R({name:"Menu",props:{menu:{type:Array,required:!1,default:[]},mode:{type:String,required:!1,default:"horizontal"},collapsed:{type:Boolean,required:!1,default:!1}},components:{RenderSubMenu:Z},setup(e,{emit:n}){const s=l.get($),t=l.get(K),i=l.get(N),m=z(),o=w({value:[]}),a=A([]),u=w({value:[]}),g=D(()=>{const r=[];return e.menu.forEach(d=>r.push(C(d))),r}),_=r=>C(r);U(()=>{S()}),k(()=>e.collapsed,r=>{r?u.value=o.value.concat():o.value=u.value}),k(()=>m.fullPath,r=>{S()});const E=r=>{if(e.mode==="horizontal"){o.value=r;return}const d=r.find(y=>!o.value.includes(y));g.value.includes(d)?o.value=d?[d]:[]:o.value=r},O=({item:r,key:d,selectedKeys:y})=>{a.value=y,n("select",{item:r,key:d,selectedKeys:a})},S=()=>{if(i){a.value=[m.path];let r=[];e.mode!=="horizontal"&&(r=H(i,m.path)),e.collapsed?u.value=r:o.value=r}};return{openKeys:o,selectedKeys:a,onOpenChange:E,onSelect:O,permissions:t,kruds:s,getPath:_,layoutMode:j}}});function ee(e,n,s,t,i,m){const o=c("RenderSubMenu"),a=c("a-menu");return p(),f(a,{mode:e.mode,openKeys:e.openKeys.value,selectedKeys:e.selectedKeys,onOpenChange:e.onOpenChange,onSelect:e.onSelect,inlineIndent:21,class:"sub-top-menu rounded-md"},{default:h(()=>[(p(!0),v(J,null,q(e.menu.filter(u=>e.permissions.permissions[u.id].show===!0),u=>(p(),f(o,{key:e.getPath(u),item:u,cruds:e.kruds,permissions:e.permissions.permissions,mode:e.mode,collapsed:e.collapsed},null,8,["item","cruds","permissions","mode","collapsed"]))),128))]),_:1},8,["mode","openKeys","selectedKeys","onOpenChange","onSelect"])}const se=B(x,[["render",ee]]),te={components:{SubTopMenu:se},computed:{menuMode(){let e=localStorage.getItem("menuMode");if(e)return e},isMobile(){return V},path(){return this.$route.fullPath}},data(){const e=l.get($),n=l.get(K),s=l.get(F),t=l.get(N),i=l.get(G);return{options:{height:"1000px"},pageType:"",property:{base_url:T,withCrudLog:i.withCrudLog,withoutHeader:!1,page_id:null,template:"drawer",mode:"refresh",title:"",projects_id:null,grid:null,form:null,form_width:800,view_url:null,actions:null,user_condition:null,parent:[],permissions:{c:!1,r:!1,u:!1,d:!1}},iframeUrl:"",iframeTitle:"",submenu:[],showSub:!1,cruds:e,menu:s,menu_list:t,permissions:n.permissions,pageTitle:"",subMenuId:"0",showNestedMenu:!1,subTopMenus:[],base_url:T}},methods:{getShowAbleChild(e){let n=e.findIndex(s=>this.can(s));return n>=0?e[n]:null},can(e){return this.permissions[e.id]?!!this.permissions[e.id].show:!1},getTitle(e){if(e.link_to=="crud"){let n=this.cruds.findIndex(s=>s.id==e.url);return n>=0?this.cruds[n].title:""}else return e.title},getPage(){var e;if(this.menu_list){let n=this.menu_list.findIndex(s=>s.id===this.$route.params.menu_id);if(n===-1&&(n=this.menu_list.findIndex(s=>s.url===this.$route.path)),n>=0){const s=this.menu_list[n];switch(this.pageType=s.link_to,this.pageType){case"crud":let t=this.cruds.findIndex(i=>i.id==s.url);if(t>=0){this.$route.meta.title=this.cruds[t].title,this.property.parent=s.parent,this.property.title=this.cruds[t].title,this.property.projects_id=this.cruds[t].projects_id,this.property.grid=this.cruds[t].grid,this.property.form=this.cruds[t].form,this.property.edit_id=this.cruds[t].edit_id,this.property.template=this.cruds[t].template,this.cruds[t].actions&&(this.property.actions=this.cruds[t].actions),this.property.main_tab_title=this.cruds[t].main_tab_title,this.property.form_width=this.cruds[t].form_width?this.cruds[t].form_width:null,this.property.view_url=this.cruds[t].view_url,this.property.permissions.c=this.permissions[s.id].c,this.property.permissions.r=this.permissions[s.id].r,this.property.permissions.u=this.permissions[s.id].u,this.property.permissions.d=this.permissions[s.id].d,this.property.permissions.gridDeleteConditionJS=this.permissions[s.id].gridDeleteConditionJS,this.property.permissions.gridEditConditionJS=this.permissions[s.id].gridEditConditionJS;let i={};this.permissions[s.id].formCondition&&(i.formCondition=this.permissions[s.id].formCondition),this.permissions[s.id].gridCondition&&(i.gridCondition=this.permissions[s.id].gridCondition),i&&(this.property.user_condition=i),this.property.page_id=s.id}break;case"link":window.location=this.menu_list[n].url;break;case"router-link":this.$router.push(this.menu_list[n].url);break;case"iframe":this.iframeUrl=s.url,this.property.title=s.title;break}if(((e=s.parent)==null?void 0:e.length)>=1){const t=s.parent.findIndex(i=>i.link_to==="noActionSubTop");if(t>=0){const{children:i}=Q(this.menu,s.parent[t].id);i!=null&&i.length&&(this.subTopMenus=i)}}}}}},beforeMount(){this.getPage()}},ie={mixins:[te]},ne={class:"rounded-md grid grow grid-nogutter"},re={key:1,class:"iframe-page"},oe=["src"];function ue(e,n,s,t,i,m){const o=P,a=L,u=c("SubTopMenu"),g=c("portal"),_=c("krud");return p(),v("div",ne,[b(a,null,{default:h(()=>[b(o,null,{default:h(()=>[X(Y(e.property.title),1)]),_:1})]),_:1}),e.subTopMenus.length?(p(),f(g,{key:0,to:"sub-top-menu"},{default:h(()=>[b(u,{menu:e.subTopMenus,collapsed:!1,mode:"horizontal"},null,8,["menu"])]),_:1})):M("",!0),I("div",{class:W(`${e.subTopMenus.length?"with-top-menu":""}`)},[e.pageType==="crud"&&e.property.page_id!=null?(p(),f(_,{key:0,template:e.property.template,property:e.property,base_url:e.property.base_url},null,8,["template","property","base_url"])):M("",!0)],2),e.pageType==="iframe"?(p(),v("div",re,[I("iframe",{src:e.iframeUrl},null,8,oe)])):M("",!0)])}const me=B(ie,[["render",ue]]);export{me as default};
