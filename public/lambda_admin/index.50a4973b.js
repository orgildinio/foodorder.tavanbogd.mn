import{H as B,T as L}from"./components.17ba8b51.js";import{s as a,K as T,P as K,f as x,h as P,j as R,l as U,g as w,a as N,i as z,M as A,L as D,b as V,k as $}from"./entry.e3cd167a.js";import{R as j}from"./RenderSubMenu.626d09f4.js";import{d as H,r as k,k as J,e as q,o as F,w as C,Y as d,a0 as f,$ as h,Z as S,a6 as G,F as Y,V as m,f as b,a1 as M,_ as I,a8 as Z,E as Q,a2 as W}from"./vue.3f3be479.js";import"./composables.cf9825ae.js";import"./common.194e1616.js";import"./ant.44dab1d6.js";import"./moment.8b5e7d95.js";import"./lodash.7f89dc3c.js";import"./numeral.30e81b7f.js";import"./cryptoJs.b278cf6a.js";const X=H({name:"Menu",props:{menu:{type:Array,required:!1,default:[]},mode:{type:String,required:!1,default:"horizontal"},collapsed:{type:Boolean,required:!1,default:!1}},components:{RenderSubMenu:j},setup(e,{emit:r}){const t=a.get(T),i=a.get(K),s=a.get(x),c=P(),o=k({value:[]}),l=J([]),u=k({value:[]}),_=q(()=>{const n=[];return e.menu.forEach(p=>n.push(w(p))),n}),g=n=>w(n);F(()=>{v()}),C(()=>e.collapsed,n=>{n?u.value=o.value.concat():o.value=u.value}),C(()=>c.fullPath,n=>{v()});const E=n=>{if(e.mode==="horizontal"){o.value=n;return}const p=n.find(y=>!o.value.includes(y));_.value.includes(p)?o.value=p?[p]:[]:o.value=n},O=({item:n,key:p,selectedKeys:y})=>{l.value=y,r("select",{item:n,key:p,selectedKeys:l})},v=()=>{if(s){l.value=[c.path];let n=[];e.mode!=="horizontal"&&(n=R(s,c.path)),e.collapsed?u.value=n:o.value=n}};return{openKeys:o,selectedKeys:l,onOpenChange:E,onSelect:O,permissions:i,kruds:t,getPath:g,layoutMode:U}}});function ee(e,r,t,i,s,c){const o=m("RenderSubMenu"),l=m("a-menu");return d(),f(l,{mode:e.mode,openKeys:e.openKeys.value,selectedKeys:e.selectedKeys,onOpenChange:e.onOpenChange,onSelect:e.onSelect,inlineIndent:21,class:"sub-top-menu rounded-md"},{default:h(()=>[(d(!0),S(Y,null,G(e.menu.filter(u=>e.permissions.permissions[u.id].show===!0),u=>(d(),f(o,{key:e.getPath(u),item:u,cruds:e.kruds,permissions:e.permissions.permissions,mode:e.mode,collapsed:e.collapsed},null,8,["item","cruds","permissions","mode","collapsed"]))),128))]),_:1},8,["mode","openKeys","selectedKeys","onOpenChange","onSelect"])}const te=N(X,[["render",ee]]),se={components:{SubTopMenu:te},computed:{menuMode(){let e=localStorage.getItem("menuMode");if(e)return e},isMobile(){return z},path(){return this.$route.fullPath}},data(){const e=a.get(T),r=a.get(K),t=a.get(A),i=a.get(x),s=a.get(D);return{options:{height:"1000px"},pageType:"",property:{base_url:V,withCrudLog:s.withCrudLog,withoutHeader:!1,page_id:null,template:"drawer",mode:"refresh",title:"",projects_id:null,grid:null,form:null,form_width:800,view_url:null,actions:null,user_condition:null,parent:[],permissions:{c:!1,r:!1,u:!1,d:!1}},iframeUrl:"",iframeTitle:"",submenu:[],showSub:!1,cruds:e,menu:t,menu_list:i,permissions:r.permissions,pageTitle:"",subMenuId:"0",showNestedMenu:!1,subTopMenus:[]}},methods:{getShowAbleChild(e){let r=e.findIndex(t=>this.can(t));return r>=0?e[r]:null},can(e){return this.permissions[e.id]?!!this.permissions[e.id].show:!1},getTitle(e){if(e.link_to=="crud"){let r=this.cruds.findIndex(t=>t.id==e.url);return r>=0?this.cruds[r].title:""}else return e.title},getPage(){var e;if(this.menu_list){let r=this.menu_list.findIndex(t=>t.id===this.$route.params.menu_id);if(r>=0){const t=this.menu_list[r];switch(this.pageType=t.link_to,this.pageType){case"crud":let i=this.cruds.findIndex(s=>s.id==t.url);if(i>=0){this.$route.meta.title=this.cruds[i].title,this.property.parent=t.parent,this.property.title=this.cruds[i].title,this.property.projects_id=this.cruds[i].projects_id,this.property.grid=this.cruds[i].grid,this.property.form=this.cruds[i].form,this.property.edit_id=this.cruds[i].edit_id,this.property.template=this.cruds[i].template,this.cruds[i].actions&&(this.property.actions=this.cruds[i].actions),this.property.main_tab_title=this.cruds[i].main_tab_title,this.property.form_width=this.cruds[i].form_width?this.cruds[i].form_width:null,this.property.view_url=this.cruds[i].view_url,this.property.permissions.c=this.permissions[t.id].c,this.property.permissions.r=this.permissions[t.id].r,this.property.permissions.u=this.permissions[t.id].u,this.property.permissions.d=this.permissions[t.id].d,this.property.permissions.gridDeleteConditionJS=this.permissions[t.id].gridDeleteConditionJS,this.property.permissions.gridEditConditionJS=this.permissions[t.id].gridEditConditionJS;let s={};this.permissions[t.id].formCondition&&(s.formCondition=this.permissions[t.id].formCondition),this.permissions[t.id].gridCondition&&(s.gridCondition=this.permissions[t.id].gridCondition),s&&(this.property.user_condition=s),this.property.page_id=t.id}break;case"link":window.location=this.menu[parentIndex].url;break;case"router-link":console.log(this.menu[parentIndex].url),this.$router.push(this.menu[parentIndex].url);break;case"iframe":this.iframeUrl=t.url,this.property.title=t.title;break}if(((e=t.parent)==null?void 0:e.length)>=1){const i=t.parent.findIndex(s=>s.link_to==="noActionSubTop");if(i>=0){const{children:s}=$(this.menu,t.parent[i].id);s!=null&&s.length&&(this.subTopMenus=s)}}}}}},beforeMount(){this.getPage()}},ie={class:"rounded-md grid grow grid-nogutter"},ne={key:1,class:"iframe-page"},re=["src"];function oe(e,r,t,i,s,c){const o=L,l=B,u=m("SubTopMenu"),_=m("portal"),g=m("krud");return d(),S("div",ie,[b(l,null,{default:h(()=>[b(o,null,{default:h(()=>[Q(W(s.property.title),1)]),_:1})]),_:1}),s.subTopMenus.length?(d(),f(_,{key:0,to:"sub-top-menu"},{default:h(()=>[b(u,{menu:s.subTopMenus,collapsed:!1,mode:"horizontal"},null,8,["menu"])]),_:1})):M("",!0),I("div",{class:Z(`${s.subTopMenus.length?"with-top-menu":""}`)},[s.pageType==="crud"&&s.property.page_id!=null?(d(),f(g,{key:0,template:s.property.template,property:s.property,base_url:s.property.base_url},null,8,["template","property","base_url"])):M("",!0)],2),s.pageType==="iframe"?(d(),S("div",ne,[I("iframe",{src:s.iframeUrl},null,8,re)])):M("",!0)])}const ye=N(se,[["render",oe]]);export{ye as default};
