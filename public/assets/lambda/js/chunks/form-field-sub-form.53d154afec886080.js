"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[931],{50061:(e,t,o)=>{o.d(t,{Z:()=>r});const r={data:function(){return{preSource:[],modal_grid_show:!1,user_condition:null,custom_condition:null,sourceGridParentBasedCondition:null}},mounted:function(){void 0!==this.form.sourceGridUserCondition&&null!==this.form.sourceGridUserCondition&&""!=this.form.sourceGridUserCondition&&(this.user_condition=JSON.parse(this.form.sourceGridUserCondition)),void 0!==this.form.sourceGridParentBasedCondition&&null!==this.form.sourceGridParentBasedCondition&&""!=this.form.sourceGridParentBasedCondition&&(this.sourceGridParentBasedCondition=JSON.parse(this.form.sourceGridParentBasedCondition))},methods:{showAddSourceModal:function(){var e=this;if(this.sourceGridParentBasedCondition){this.custom_condition={};var t=!1;this.sourceGridParentBasedCondition.forEach((function(o){void 0!==e.model.form[o.parent_field]&&null!==e.model.form[o.parent_field]?e.custom_condition[o.grid_field]=e.model.form[o.parent_field]:(t=!0,e.$Notice.error({title:o.message}))})),t||this.showAddSourceModalReal()}else this.showAddSourceModalReal()},showAddSourceModalReal:function(){this.modal_grid_show=!0,this.$modal.show("grid-modal-".concat(this.form.sourceGridID))},closeSourceModal:function(){this.modal_grid_show=!1,this.$modal.hide("grid-modal-".concat(this.form.sourceGridID))},addFromPreSource:function(){var e=this;this.preSource&&this.form.sourceGridTargetColumns&&this.preSource.forEach((function(t){e.createDataFromSource(t)})),this.closeSourceModal()},createDataFromSource:function(e){var t=this,o=_.cloneDeep(this.form),r={};o.schema.forEach((function(e){o.identity!=e.model&&null!=e.formType&&(!o.timestamp||"created_at"!=e.model&&e.model)})),this.form.sourceGridTargetColumns.forEach((function(t){Vue.set(r,t.selfColumn,e[t.sourceColumn])}));var i={form:o,model:r};if(null==this.model.form[this.model.component]&&(this.model.form[this.model.component]=[]),""!==this.form.sourceUniqueField&&void 0!==this.form.sourceUniqueField&&null!==this.form.sourceUniqueField){var n=this.model.form[this.model.component].findIndex((function(e){return e[t.form.sourceUniqueField]===r[t.form.sourceUniqueField]}));if(-1!==n)return}this.model.form[this.model.component].push(r),this.listData.push(i),this.rowLength=this.model.form[this.model.component].length},onRowSelect:function(e){this.preSource=e},sourceGridUrl:function(){var e=this;if(window.init.microserviceSettings){var t=window.init.microserviceSettings.findIndex((function(t){return t.project_id==e.form.sourceMicroserviceID}));return t>=0?window.init.microserviceSettings[t].production_url:""}return""}}}},62995:(e,t,o)=>{function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}o.r(t),o.d(t,{default:()=>c});var i=o(16133),n=o(3436);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function s(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function d(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const l={props:["form","model","editMode","relations","formula","url"],mixins:[o(50061).Z],components:{"grid-form":n.Z,dataform:function(){return o.e(826).then(o.bind(o,11332))}},mounted:function(){this.equationRenderer(),this.form.schema.forEach((function(e){e.disabled=!0}))},computed:{lang:function(){var e=this,t=["pleaseCompleteFirstLine"];return t.reduce((function(o,r,i){return o[r]=e.$t("dataForm."+t[i]),o}),{})},subStyle:function(){return this.form.min_height?{minHeight:this.form.min_height+"px",background:"#f3f4f5"}:void 0},Lang:function(){var e=this,t=["add"];return t.reduce((function(o,r,i){return o[r]=e.$t("dataForm."+t[i]),o}),{})}},watch:{listData:{handler:function(e,t){this.hasEq&&this.equationData.map((function(t){if(t.hasEquation){t.data=-1;var o=0;switch(t.equation){case"SUM":t.data=0,e.map((function(e){t.data+=Number(isNaN(parseInt(e.model[t.model],10))?0:e.model[t.model])}));break;case"COUNT":t.data=0,e.map((function(e){t.data+=Number(1)}));break;case"MIN":e.map((function(e){-1==t.data?t.data=e.model[t.model]:t.data=Math.min(t.data,e.model[t.model])}));break;case"MAX":t.data=0,e.map((function(e){t.data=Math.max(t.data,e.model[t.model])}));break;case"AVG":t.data=0,e.map((function(e){o++,t.data+=Number(e.model[t.model])})),t.data=Number(t.data/o)}}}))},deep:!0}},data:function(){return{listData:[],equationData:[],currentSortDir:"asc",hasEq:!1,modal_show:!1,editIndex:-1}},methods:{showAddModal:function(){this.modal_show=!0},closeModal:function(){this.modal_show=!1,this.editIndex=-1},formReady:function(e,t){var o=this,r=t.findIndex((function(e){return e.model==o.form.parent}));r>0&&(t[r].hidden=!0),this.editIndex>=0&&this.$nextTick((function(){o.$refs.form.editModel(o.listData[o.editIndex].model[o.form.identity],function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?s(Object(o),!0).forEach((function(t){d(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({},o.listData[o.editIndex].model))}))},onError:function(){},onSuccess:function(e){var t=this;if(this.editIndex>=0)Object.keys(e).forEach((function(o){t.listData[t.editIndex].form.identity!=o&&"created_at"!=o&&"updated_at"!=o&&Vue.set(t.listData[t.editIndex].model,o,e[o])}));else{var o=_.cloneDeep(this.form),r={};Object.keys(e).forEach((function(t){var i=o.schema.findIndex((function(e){return"key"==e.model}));if(i>=0){if(o.identity==o.schema[i].model||null==o.schema[i].formType)return;if(o.timestamp&&("created_at"==o.schema[i].model||"updated_at"==o.schema[i].model))return}Vue.set(r,t,e[t])}));var i={form:o,model:r},n=this.model.form[this.model.component];null==n&&(n=[]),n.push(r),Vue.set(this.model.form,this.model.component,n),this.listData.push(i)}this.closeModal()},element:i.b,checkAddable:function(){var e=this;return new Promise((function(t,o){var r=e.listData[e.listData.length-1];if(r){var i=!1,n=r.model;for(var s in n)null!=a(n[s])&&null!=n[s]&&""!=n[s]&&0!=n[s]&&(i=!0);i?t(!0):(alert(e.lang.pleaseCompleteFirstLine),o(!1))}else t(!0)}))},addSubForm:function(){var e=_.cloneDeep(this.form),t={};e.schema.forEach((function(o){e.identity!=o.model&&null!=o.formType&&(!e.timestamp||"created_at"!=o.model&&"updated_at"!=o.model)&&Vue.set(t,o.model,o.default)}));var o={form:e,model:t};null==this.model.form[this.model.component]&&(this.model.form[this.model.component]=[]),this.model.form[this.model.component].push(t),this.listData.push(o)},add:function(){this.form.addFromGrid&&this.form.sourceGridID?this.showAddSourceModal():this.addByFrom()},addByFrom:function(){this.closeSourceModal(),this.editIndex=-1,this.showAddModal()},fillData:function(){var e=this;this.listData=[],setTimeout((function(){e.model.form[e.model.component].forEach((function(t){var o={form:_.cloneDeep(e.form),model:t};e.listData.push(o)}))}),100)},equationRenderer:function(){var e=this;this.equationData=[],this.form.schema.map((function(t){""==t.label||t.hidden||(t.hasEquation&&(e.hasEq=!0),e.equationData.push({hasEquation:t.hasEquation,equation:t.equations,prefix:t.prefix,model:t.model,preStaticWord:t.preStaticWord,data:0}))}))},edit:function(e){this.model.form[this.form.model][e],this.editIndex=e,this.showAddModal()},remove:function(e){this.model.form[this.form.model].splice(e,1),this.listData.splice(e,1)},reset:function(){this.model.form[this.form.model]=[],this.listData=[]},sort:function(e){var t=this,o=1;this.currentSortDir="asc"===this.currentSortDir?"desc":"asc",this.currentSort="desc"===this.currentSortDir?-1:1,this.currentSort=e.model,this.listData.sort((function(e,r){return"desc"===t.currentSortDir&&(o=-1),e.model[t.currentSort]<r.model[t.currentSort]?-1*o:e.model[t.currentSort]>r.model[t.currentSort]?1*o:0}))}}};const c=(0,o(51900).Z)(l,(function(){var e,t=this,o=t._self._c;return o("div",{staticClass:"subform-grid sub-modal-form",style:t.subStyle},[t.form.min_height||t.form.disableCreate?t._e():o("div",{staticClass:"subform-header"},[t._v("\n            "+t._s(t.form.name)+"\n            "),o("Button",{staticClass:"sub-form-add-btn",attrs:{shape:"circle",type:"success",size:"small",icon:"md-add"},on:{click:t.add}})],1),t._v(" "),t.form.min_height||this.listData.length>=1?o("table",{staticClass:"sub-form-grid",attrs:{border:"1"}},[o("thead",[o("tr",[t.form.showRowNumber?o("th",{staticClass:"row-number"},[t._v("ДД")]):t._e(),t._v(" "),t._l(t.form.schema,(function(e){return""==e.label||e.hidden?t._e():o("th",{key:e.index,on:{click:function(o){return t.sort(e)}}},[o("div",{staticClass:"th-title"},[t._v("\n                        "+t._s(e.label)+" "),o("i",{staticClass:"ti-exchange-vertical"})])])})),t._v(" "),o("th",{staticClass:"action"},[t._v("...")])],2)]),t._v(" "),o("tbody",t._l(t.listData,(function(e,r){return o("grid-form",{key:r,attrs:{f:e.form,model:e.model,editMode:t.editMode,relations:t.relations,formula:t.formula,schema:t.form.schema}},[o("template",{slot:"action"},[t.form.disableEdit?t._e():o("a",{staticClass:"sub-edit",attrs:{href:"javscript:void(0)"},on:{click:function(){return t.edit(r)}}},[o("Icon",{attrs:{type:"md-create"}})],1),t._v(" "),t.form.disableDelete?t._e():o("a",{attrs:{href:"javscript:void(0)"},on:{click:function(){return t.remove(r)}}},[o("Icon",{attrs:{type:"ios-trash"}})],1)]),t._v(" "),t.form.showRowNumber?o("template",{slot:"rowNumber"},[o("span",[t._v(t._s(r+1))])]):t._e()],2)})),1),t._v(" "),t.hasEq?o("tfoot",[o("tr",[t._l(t.equationData,(function(e,r){return o("td",{key:r},[null!=e.preStaticWord&&""!=e.preStaticWord?o("span",[t._v(" "+t._s(e.preStaticWord)+" ")]):t._e(),t._v(" "),e.hasEquation?o("span",[t._v(t._s(e.data.toLocaleString()))]):t._e(),t._v(" "),null!=e.prefix&&""!=e.prefix?o("span",[t._v(" "+t._s(e.prefix))]):t._e()])})),t._v(" "),o("td")],2)]):t._e()]):t._e(),t._v(" "),t.form.min_height?o("a",{staticClass:"sub-grid-add",attrs:{href:"javascript:void(0)"},on:{click:t.add}},[o("Icon",{attrs:{type:"plus"}}),t._v("\n            "+t._s(t.lang.save)+"\n        ")],1):t._e(),t._v(" "),o("Modal",{attrs:{"min-width":200,"min-height":100,draggable:!0,"footer-hide":!0,title:t.form.name,width:"85%",height:"85%"},model:{value:t.modal_show,callback:function(e){t.modal_show=e},expression:"modal_show"}},[o("section",{staticClass:"form-modal"},[o("div",{staticClass:"form-body"},[t.modal_show?o("dataform",{ref:"form",attrs:{schemaID:t.form.formId,do_render:t.modal_show,editMode:t.editIndex>=0,isSubForm:!0,onSuccess:t.onSuccess,url:t.url,onReady:t.formReady,onError:t.onError}}):t._e()],1)])]),t._v(" "),o("paper-modal",{staticClass:"form-modal",attrs:(e={name:"grid-modal-".concat(t.form.sourceGridID),"min-width":200,"min-height":100,"pivot-y":.5,adaptive:!0,reset:!0,draggable:!0,resizable:!0},r(e,"draggable",".form-tool"),r(e,"width","85%"),r(e,"height","50%"),e)},[o("section",{staticClass:"form-modal source-grid"},[o("div",{staticClass:"form-tool"},[o("h4",[t._v(t._s(t.form.sourceGridModalTitle))]),t._v(" "),o("div",{staticClass:"form-tool-actions"},[o("a",{attrs:{href:"javascript:void(0)"},on:{click:t.closeSourceModal}},[o("i",{staticClass:"ti-close"})])])]),t._v(" "),t.modal_grid_show?o("div",{staticClass:"form-body"},[t.form.sourceGridTitle&&t.form.sourceGridDescription?o("div",{staticClass:"source-grid-description"},[o("h3",[t._v("\n                            "+t._s(t.form.sourceGridTitle)+"\n                        ")]),t._v(" "),o("p",{domProps:{innerHTML:t._s(t.form.sourceGridDescription)}})]):t._e(),t._v(" "),o("datagrid",{attrs:{schemaID:t.form.sourceGridID,url:t.sourceGridUrl(),onRowSelect:t.onRowSelect,user_condition:t.user_condition,paginate:50,hasSelection:!0,permissions:{c:!1,r:!0,u:!1,d:!1}}}),t._v(" "),o("div",{staticClass:"add-from-pre-source"},[o("Button",{staticClass:"sub-form-add-btn",attrs:{shape:"circle",type:"primary",size:"small",disabled:t.preSource.length>=1,icon:"md-add"},on:{click:t.addByFrom}},[t._v("Шинээр бүртгэх")]),t._v(" "),o("Button",{staticClass:"sub-form-add-btn",attrs:{shape:"circle",type:"success",size:"small",disabled:0==t.preSource.length,icon:"md-add"},on:{click:t.addFromPreSource}},[t._v("Сонгох")])],1)],1):t._e()])])],1)}),[],!1,null,null,null).exports},3436:(e,t,o)=>{o.d(t,{Z:()=>s});var r=o(16133),i=(o(74971),o(84006)),n=o(9854);const a={props:["f","model","editMode","relations","formula","schema"],created:function(){var e=this;this.f.data={},this.f.schema.forEach((function(t){e.f.identity!=t.model&&null!=t.formType&&(!e.f.timestamp||"created_at"!=t.model&&"updated_at"!=t.model)&&(e.editMode?e.setModel(t.model,e.model[t.model],t.formType):e.setModel(t.model,t.default,t.formType),e.$watch("model."+t.model,{handler:function(o,r){e.afterChange(t.model,o,r)},deep:!0}))}))},methods:{isShowAble:function(e){if(this.schema){var t=this.schema.findIndex((function(t){return t.model==e}));return t>=0&&!this.schema[t].hidden}return!0},element:r.b,setModel:function(e,t,o){switch(o){case"Switch":"true"!=t&&1!=t||!0,this.model[e]=r,this.f.data[e]=r;break;case"Checkbox":var r=0;"true"!=t&&1!=t||(r=1),this.model[e]=r,this.f.data[e]=r;break;default:this.f.data[e]=t}},setMeta:function(e){return delete e.table,delete e.rules,delete e.label,delete e.span,delete e.default,e},getSchemaIndex:function(e){return this.f.schema.findIndex((function(t){return t.model==e}))},afterChange:function(e,t,o){(0,i.BS)(e,t,this.model,this.f.schema,this.$refs,this.$Notice),(0,i.x4)(this.formula,e,this.model,this.f.schema,this.f.rule,this.f.model)},getSchemaRelationByModel:function(e){var t=this.f.schema.findIndex((function(t){return t.model==e}));return t>=0?(0,n.gN)(this.f.schema[t],this.relations):null},getRelation:function(e){return(0,n.gN)(e,this.relations)}}};const s=(0,o(51900).Z)(a,(function(){var e=this,t=e._self._c;return t("tr",[e.f.showRowNumber?t("td",{staticClass:"row-number"},[e._t("rowNumber")],2):e._e(),e._v(" "),e._l(e.f.schema,(function(o){return void 0!==o.formType&&null!==o.formType&&o.model&&e.isShowAble(o.model)&&o.model!=e.f.identity&&o.model!=e.f.parent&&"updated_at"!=o.model&&"created_at"!=o.model&&!o.hidden?t("td",{key:o.index},[e.model?t(e.element(o.formType),{tag:"component",attrs:{model:{form:e.model,component:o.model},size:"small",label:o.label?o.label:"[".concat(o.model,"]"),meta:e.setMeta(o),getSchemaRelationByModel:e.getSchemaRelationByModel,relation_data:e.getRelation(o)}}):e._e()],1):e._e()})),e._v(" "),t("td",{staticClass:"action"},[e._t("action")],2)],2)}),[],!1,null,null,null).exports}}]);
//# sourceMappingURL=form-field-sub-form.53d154afec886080.js.map